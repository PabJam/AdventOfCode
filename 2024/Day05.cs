using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Utils;

namespace _2024
{
    public static class Day05
    {
        public const string test_input_1 = "47|53\r\n97|13\r\n97|61\r\n97|47\r\n75|29\r\n61|13\r\n75|53\r\n29|13\r\n97|29\r\n53|29\r\n61|53\r\n97|53\r\n61|29\r\n47|13\r\n75|47\r\n97|75\r\n47|61\r\n75|61\r\n47|29\r\n75|13\r\n53|13\r\n\r\n75,47,61,53,29\r\n97,61,53,29,13\r\n75,29,13\r\n75,97,47,61,53\r\n61,13,29\r\n97,13,75,29,47";
        public const string input_1 = "15|78\r\n65|46\r\n65|23\r\n54|46\r\n54|41\r\n54|15\r\n53|42\r\n53|24\r\n53|82\r\n53|73\r\n38|53\r\n38|83\r\n38|78\r\n38|56\r\n38|44\r\n73|74\r\n73|34\r\n73|49\r\n73|54\r\n73|84\r\n73|23\r\n41|26\r\n41|78\r\n41|72\r\n41|79\r\n41|83\r\n41|73\r\n41|76\r\n87|65\r\n87|25\r\n87|44\r\n87|18\r\n87|23\r\n87|47\r\n87|63\r\n87|74\r\n76|36\r\n76|23\r\n76|93\r\n76|54\r\n76|49\r\n76|46\r\n76|25\r\n76|73\r\n76|34\r\n72|96\r\n72|76\r\n72|83\r\n72|79\r\n72|17\r\n72|51\r\n72|35\r\n72|65\r\n72|23\r\n72|82\r\n84|15\r\n84|64\r\n84|68\r\n84|31\r\n84|71\r\n84|54\r\n84|44\r\n84|36\r\n84|47\r\n84|96\r\n84|29\r\n88|41\r\n88|13\r\n88|93\r\n88|71\r\n88|17\r\n88|56\r\n88|37\r\n88|83\r\n88|24\r\n88|82\r\n88|11\r\n88|79\r\n93|35\r\n93|36\r\n93|49\r\n93|74\r\n93|87\r\n93|47\r\n93|96\r\n93|23\r\n93|17\r\n93|18\r\n93|42\r\n93|59\r\n93|46\r\n46|29\r\n46|26\r\n46|13\r\n46|31\r\n46|88\r\n46|37\r\n46|15\r\n46|71\r\n46|11\r\n46|64\r\n46|59\r\n46|53\r\n46|51\r\n46|74\r\n18|13\r\n18|47\r\n18|36\r\n18|64\r\n18|11\r\n18|68\r\n18|41\r\n18|23\r\n18|46\r\n18|34\r\n18|84\r\n18|29\r\n18|96\r\n18|54\r\n18|53\r\n35|23\r\n35|54\r\n35|74\r\n35|38\r\n35|68\r\n35|18\r\n35|47\r\n35|63\r\n35|34\r\n35|65\r\n35|87\r\n35|98\r\n35|84\r\n35|46\r\n35|59\r\n35|41\r\n92|73\r\n92|98\r\n92|84\r\n92|83\r\n92|35\r\n92|26\r\n92|89\r\n92|63\r\n92|24\r\n92|82\r\n92|79\r\n92|65\r\n92|87\r\n92|93\r\n92|49\r\n92|72\r\n92|42\r\n24|42\r\n24|17\r\n24|93\r\n24|87\r\n24|54\r\n24|96\r\n24|38\r\n24|59\r\n24|46\r\n24|35\r\n24|84\r\n24|44\r\n24|18\r\n24|47\r\n24|65\r\n24|73\r\n24|49\r\n24|25\r\n29|72\r\n29|42\r\n29|56\r\n29|73\r\n29|37\r\n29|51\r\n29|87\r\n29|17\r\n29|82\r\n29|49\r\n29|83\r\n29|98\r\n29|53\r\n29|93\r\n29|79\r\n29|78\r\n29|24\r\n29|12\r\n29|26\r\n74|15\r\n74|78\r\n74|41\r\n74|64\r\n74|51\r\n74|88\r\n74|83\r\n74|12\r\n74|82\r\n74|31\r\n74|79\r\n74|92\r\n74|89\r\n74|53\r\n74|26\r\n74|71\r\n74|68\r\n74|11\r\n74|29\r\n74|72\r\n37|89\r\n37|26\r\n37|83\r\n37|72\r\n37|92\r\n37|93\r\n37|63\r\n37|25\r\n37|51\r\n37|79\r\n37|98\r\n37|56\r\n37|12\r\n37|49\r\n37|24\r\n37|17\r\n37|18\r\n37|35\r\n37|87\r\n37|84\r\n37|73\r\n17|31\r\n17|18\r\n17|42\r\n17|98\r\n17|25\r\n17|46\r\n17|54\r\n17|35\r\n17|87\r\n17|23\r\n17|68\r\n17|47\r\n17|96\r\n17|38\r\n17|59\r\n17|63\r\n17|15\r\n17|34\r\n17|36\r\n17|44\r\n17|49\r\n17|74\r\n56|26\r\n56|79\r\n56|42\r\n56|51\r\n56|25\r\n56|47\r\n56|84\r\n56|98\r\n56|17\r\n56|73\r\n56|49\r\n56|83\r\n56|89\r\n56|76\r\n56|23\r\n56|35\r\n56|63\r\n56|24\r\n56|18\r\n56|93\r\n56|65\r\n56|96\r\n56|82\r\n26|24\r\n26|47\r\n26|83\r\n26|98\r\n26|49\r\n26|87\r\n26|63\r\n26|25\r\n26|82\r\n26|76\r\n26|51\r\n26|35\r\n26|54\r\n26|96\r\n26|79\r\n26|42\r\n26|84\r\n26|18\r\n26|93\r\n26|23\r\n26|17\r\n26|65\r\n26|89\r\n26|73\r\n11|26\r\n11|73\r\n11|92\r\n11|29\r\n11|76\r\n11|64\r\n11|37\r\n11|53\r\n11|79\r\n11|89\r\n11|83\r\n11|35\r\n11|72\r\n11|93\r\n11|12\r\n11|49\r\n11|24\r\n11|42\r\n11|51\r\n11|17\r\n11|82\r\n11|56\r\n11|78\r\n11|13\r\n71|26\r\n71|51\r\n71|17\r\n71|93\r\n71|24\r\n71|41\r\n71|78\r\n71|89\r\n71|64\r\n71|92\r\n71|11\r\n71|79\r\n71|76\r\n71|29\r\n71|82\r\n71|37\r\n71|13\r\n71|73\r\n71|49\r\n71|83\r\n71|72\r\n71|12\r\n71|53\r\n71|56\r\n13|12\r\n13|73\r\n13|42\r\n13|29\r\n13|35\r\n13|89\r\n13|51\r\n13|53\r\n13|76\r\n13|26\r\n13|17\r\n13|78\r\n13|56\r\n13|79\r\n13|64\r\n13|37\r\n13|93\r\n13|49\r\n13|87\r\n13|82\r\n13|24\r\n13|92\r\n13|72\r\n13|83\r\n25|96\r\n25|84\r\n25|74\r\n25|34\r\n25|46\r\n25|68\r\n25|63\r\n25|71\r\n25|54\r\n25|18\r\n25|41\r\n25|88\r\n25|65\r\n25|47\r\n25|44\r\n25|31\r\n25|11\r\n25|23\r\n25|38\r\n25|36\r\n25|59\r\n25|15\r\n25|98\r\n25|13\r\n82|17\r\n82|47\r\n82|18\r\n82|46\r\n82|79\r\n82|84\r\n82|42\r\n82|76\r\n82|54\r\n82|23\r\n82|87\r\n82|63\r\n82|59\r\n82|98\r\n82|96\r\n82|36\r\n82|24\r\n82|93\r\n82|25\r\n82|34\r\n82|49\r\n82|73\r\n82|35\r\n82|65\r\n36|64\r\n36|78\r\n36|38\r\n36|41\r\n36|59\r\n36|68\r\n36|72\r\n36|37\r\n36|29\r\n36|88\r\n36|53\r\n36|71\r\n36|31\r\n36|26\r\n36|13\r\n36|12\r\n36|34\r\n36|15\r\n36|46\r\n36|44\r\n36|74\r\n36|56\r\n36|92\r\n36|11\r\n47|11\r\n47|92\r\n47|74\r\n47|36\r\n47|71\r\n47|64\r\n47|31\r\n47|12\r\n47|78\r\n47|68\r\n47|46\r\n47|38\r\n47|59\r\n47|34\r\n47|53\r\n47|72\r\n47|13\r\n47|54\r\n47|37\r\n47|15\r\n47|44\r\n47|41\r\n47|88\r\n47|29\r\n98|65\r\n98|11\r\n98|59\r\n98|63\r\n98|44\r\n98|31\r\n98|74\r\n98|71\r\n98|68\r\n98|23\r\n98|41\r\n98|88\r\n98|34\r\n98|36\r\n98|84\r\n98|13\r\n98|38\r\n98|15\r\n98|18\r\n98|54\r\n98|64\r\n98|47\r\n98|96\r\n98|46\r\n44|41\r\n44|92\r\n44|15\r\n44|37\r\n44|26\r\n44|72\r\n44|64\r\n44|71\r\n44|89\r\n44|83\r\n44|88\r\n44|78\r\n44|74\r\n44|51\r\n44|13\r\n44|11\r\n44|53\r\n44|79\r\n44|31\r\n44|56\r\n44|82\r\n44|68\r\n44|29\r\n44|12\r\n96|29\r\n96|54\r\n96|38\r\n96|92\r\n96|13\r\n96|68\r\n96|34\r\n96|31\r\n96|88\r\n96|46\r\n96|53\r\n96|74\r\n96|47\r\n96|36\r\n96|44\r\n96|71\r\n96|59\r\n96|64\r\n96|78\r\n96|12\r\n96|15\r\n96|11\r\n96|37\r\n96|41\r\n79|49\r\n79|63\r\n79|59\r\n79|96\r\n79|87\r\n79|18\r\n79|23\r\n79|36\r\n79|34\r\n79|54\r\n79|42\r\n79|98\r\n79|24\r\n79|93\r\n79|46\r\n79|25\r\n79|73\r\n79|65\r\n79|84\r\n79|35\r\n79|38\r\n79|17\r\n79|47\r\n79|76\r\n12|83\r\n12|87\r\n12|51\r\n12|72\r\n12|76\r\n12|49\r\n12|93\r\n12|89\r\n12|42\r\n12|82\r\n12|25\r\n12|56\r\n12|65\r\n12|18\r\n12|35\r\n12|24\r\n12|84\r\n12|26\r\n12|79\r\n12|23\r\n12|98\r\n12|63\r\n12|73\r\n12|17\r\n31|82\r\n31|51\r\n31|76\r\n31|78\r\n31|26\r\n31|56\r\n31|89\r\n31|88\r\n31|83\r\n31|29\r\n31|93\r\n31|24\r\n31|37\r\n31|92\r\n31|79\r\n31|64\r\n31|11\r\n31|12\r\n31|72\r\n31|73\r\n31|13\r\n31|53\r\n31|71\r\n31|41\r\n49|98\r\n49|15\r\n49|44\r\n49|88\r\n49|68\r\n49|36\r\n49|46\r\n49|84\r\n49|65\r\n49|31\r\n49|47\r\n49|59\r\n49|25\r\n49|38\r\n49|42\r\n49|54\r\n49|74\r\n49|23\r\n49|87\r\n49|63\r\n49|96\r\n49|35\r\n49|34\r\n49|18\r\n78|51\r\n78|89\r\n78|98\r\n78|56\r\n78|87\r\n78|72\r\n78|79\r\n78|83\r\n78|25\r\n78|24\r\n78|76\r\n78|73\r\n78|63\r\n78|17\r\n78|35\r\n78|49\r\n78|37\r\n78|12\r\n78|26\r\n78|93\r\n78|42\r\n78|92\r\n78|18\r\n78|82\r\n42|63\r\n42|31\r\n42|46\r\n42|87\r\n42|96\r\n42|23\r\n42|71\r\n42|74\r\n42|15\r\n42|36\r\n42|88\r\n42|54\r\n42|25\r\n42|98\r\n42|68\r\n42|44\r\n42|84\r\n42|38\r\n42|34\r\n42|59\r\n42|65\r\n42|47\r\n42|35\r\n42|18\r\n68|72\r\n68|53\r\n68|13\r\n68|79\r\n68|41\r\n68|64\r\n68|24\r\n68|88\r\n68|82\r\n68|71\r\n68|76\r\n68|93\r\n68|31\r\n68|83\r\n68|26\r\n68|92\r\n68|29\r\n68|51\r\n68|56\r\n68|11\r\n68|89\r\n68|12\r\n68|78\r\n68|37\r\n64|93\r\n64|37\r\n64|79\r\n64|83\r\n64|87\r\n64|72\r\n64|26\r\n64|49\r\n64|73\r\n64|17\r\n64|25\r\n64|92\r\n64|56\r\n64|76\r\n64|78\r\n64|12\r\n64|35\r\n64|82\r\n64|51\r\n64|89\r\n64|24\r\n64|29\r\n64|42\r\n64|53\r\n63|74\r\n63|36\r\n63|71\r\n63|68\r\n63|65\r\n63|23\r\n63|13\r\n63|11\r\n63|34\r\n63|46\r\n63|54\r\n63|44\r\n63|15\r\n63|29\r\n63|88\r\n63|59\r\n63|64\r\n63|47\r\n63|96\r\n63|84\r\n63|31\r\n63|18\r\n63|38\r\n63|41\r\n51|25\r\n51|47\r\n51|49\r\n51|35\r\n51|89\r\n51|82\r\n51|42\r\n51|79\r\n51|98\r\n51|65\r\n51|54\r\n51|83\r\n51|84\r\n51|24\r\n51|73\r\n51|17\r\n51|23\r\n51|63\r\n51|36\r\n51|18\r\n51|96\r\n51|76\r\n51|93\r\n51|87\r\n23|54\r\n23|34\r\n23|88\r\n23|64\r\n23|36\r\n23|78\r\n23|37\r\n23|53\r\n23|92\r\n23|96\r\n23|46\r\n23|13\r\n23|59\r\n23|74\r\n23|71\r\n23|15\r\n23|38\r\n23|31\r\n23|44\r\n23|68\r\n23|29\r\n23|11\r\n23|47\r\n23|41\r\n83|65\r\n83|63\r\n83|18\r\n83|54\r\n83|36\r\n83|82\r\n83|96\r\n83|46\r\n83|47\r\n83|76\r\n83|35\r\n83|17\r\n83|87\r\n83|79\r\n83|98\r\n83|73\r\n83|25\r\n83|93\r\n83|24\r\n83|49\r\n83|42\r\n83|89\r\n83|23\r\n83|84\r\n89|82\r\n89|73\r\n89|79\r\n89|63\r\n89|76\r\n89|36\r\n89|49\r\n89|17\r\n89|65\r\n89|59\r\n89|24\r\n89|93\r\n89|54\r\n89|87\r\n89|47\r\n89|98\r\n89|25\r\n89|84\r\n89|46\r\n89|35\r\n89|18\r\n89|42\r\n89|96\r\n89|23\r\n59|31\r\n59|38\r\n59|51\r\n59|53\r\n59|68\r\n59|29\r\n59|13\r\n59|41\r\n59|11\r\n59|78\r\n59|74\r\n59|72\r\n59|92\r\n59|37\r\n59|15\r\n59|44\r\n59|71\r\n59|88\r\n59|12\r\n59|34\r\n59|26\r\n59|64\r\n59|83\r\n59|56\r\n34|38\r\n34|83\r\n34|31\r\n34|68\r\n34|71\r\n34|74\r\n34|37\r\n34|64\r\n34|53\r\n34|89\r\n34|51\r\n34|56\r\n34|72\r\n34|44\r\n34|41\r\n34|88\r\n34|78\r\n34|11\r\n34|15\r\n34|12\r\n34|26\r\n34|29\r\n34|13\r\n34|92\r\n15|82\r\n15|79\r\n15|13\r\n15|76\r\n15|26\r\n15|53\r\n15|56\r\n15|41\r\n15|51\r\n15|31\r\n15|11\r\n15|83\r\n15|64\r\n15|29\r\n15|24\r\n15|72\r\n15|12\r\n15|37\r\n15|88\r\n15|71\r\n15|89\r\n15|68\r\n15|92\r\n65|74\r\n65|78\r\n65|41\r\n65|88\r\n65|71\r\n65|59\r\n65|13\r\n65|47\r\n65|37\r\n65|11\r\n65|53\r\n65|44\r\n65|29\r\n65|64\r\n65|38\r\n65|96\r\n65|36\r\n65|54\r\n65|15\r\n65|34\r\n65|31\r\n65|68\r\n54|37\r\n54|71\r\n54|29\r\n54|88\r\n54|31\r\n54|53\r\n54|13\r\n54|38\r\n54|12\r\n54|92\r\n54|74\r\n54|56\r\n54|44\r\n54|36\r\n54|68\r\n54|34\r\n54|11\r\n54|78\r\n54|59\r\n54|72\r\n54|64\r\n53|89\r\n53|37\r\n53|51\r\n53|63\r\n53|83\r\n53|87\r\n53|35\r\n53|76\r\n53|98\r\n53|26\r\n53|25\r\n53|92\r\n53|49\r\n53|79\r\n53|12\r\n53|72\r\n53|93\r\n53|78\r\n53|56\r\n53|17\r\n38|13\r\n38|31\r\n38|29\r\n38|82\r\n38|12\r\n38|68\r\n38|72\r\n38|92\r\n38|88\r\n38|89\r\n38|41\r\n38|51\r\n38|37\r\n38|71\r\n38|64\r\n38|15\r\n38|11\r\n38|26\r\n38|74\r\n73|98\r\n73|36\r\n73|35\r\n73|44\r\n73|63\r\n73|15\r\n73|17\r\n73|47\r\n73|65\r\n73|46\r\n73|18\r\n73|96\r\n73|87\r\n73|42\r\n73|59\r\n73|25\r\n73|38\r\n73|68\r\n41|37\r\n41|82\r\n41|12\r\n41|51\r\n41|53\r\n41|29\r\n41|56\r\n41|13\r\n41|89\r\n41|49\r\n41|64\r\n41|93\r\n41|17\r\n41|42\r\n41|24\r\n41|92\r\n41|11\r\n87|11\r\n87|31\r\n87|38\r\n87|59\r\n87|15\r\n87|36\r\n87|84\r\n87|54\r\n87|34\r\n87|88\r\n87|71\r\n87|96\r\n87|68\r\n87|46\r\n87|98\r\n87|41\r\n76|17\r\n76|96\r\n76|42\r\n76|24\r\n76|63\r\n76|44\r\n76|38\r\n76|35\r\n76|18\r\n76|47\r\n76|84\r\n76|87\r\n76|65\r\n76|59\r\n76|98\r\n72|89\r\n72|25\r\n72|26\r\n72|24\r\n72|42\r\n72|56\r\n72|49\r\n72|93\r\n72|87\r\n72|18\r\n72|73\r\n72|98\r\n72|63\r\n72|84\r\n84|11\r\n84|13\r\n84|74\r\n84|53\r\n84|34\r\n84|59\r\n84|65\r\n84|38\r\n84|78\r\n84|46\r\n84|41\r\n84|88\r\n84|23\r\n88|78\r\n88|26\r\n88|12\r\n88|76\r\n88|72\r\n88|51\r\n88|73\r\n88|92\r\n88|64\r\n88|89\r\n88|29\r\n88|53\r\n93|54\r\n93|25\r\n93|63\r\n93|84\r\n93|73\r\n93|34\r\n93|98\r\n93|15\r\n93|44\r\n93|65\r\n93|38\r\n46|78\r\n46|56\r\n46|34\r\n46|12\r\n46|92\r\n46|41\r\n46|72\r\n46|44\r\n46|38\r\n46|68\r\n18|65\r\n18|38\r\n18|59\r\n18|88\r\n18|31\r\n18|44\r\n18|71\r\n18|15\r\n18|74\r\n35|25\r\n35|71\r\n35|96\r\n35|31\r\n35|15\r\n35|36\r\n35|44\r\n35|88\r\n92|17\r\n92|25\r\n92|76\r\n92|56\r\n92|18\r\n92|12\r\n92|51\r\n24|34\r\n24|98\r\n24|63\r\n24|74\r\n24|36\r\n24|23\r\n29|89\r\n29|25\r\n29|92\r\n29|35\r\n29|76\r\n74|76\r\n74|56\r\n74|37\r\n74|13\r\n37|82\r\n37|76\r\n37|42\r\n17|65\r\n17|84\r\n56|87\r\n\r\n38,68,88,11,13,64,29,37,92,72,26,83,89\r\n92,12,72,26,51,83,79,76,24,17,49,42,87,25,63,18,84\r\n37,26,79,73,87\r\n15,47,78,68,53\r\n93,17,49,63,18,23,96,47,36,34,44\r\n11,36,88,13,59,38,46,34,71,68,12,31,92,54,47,44,29,37,64,78,74\r\n26,72,42,84,87,65,24,12,79\r\n41,13,53,92,51,83,76,93,49\r\n26,78,74,51,56,37,41,88,59,31,68,13,34,92,44,64,71,15,72\r\n47,59,15,71,41,53,12\r\n72,82,89,83,92,37,42,53,87,73,76,26,78,49,79\r\n13,51,83,29,37,92,78,68,41,44,88,38,26,53,11,64,34,12,74\r\n93,73,17,49,42,35,87,25,98,63,18,84,65,23,96,47,54,36,46,59,34,38,74\r\n23,35,63,42,46,25,93,79,98,87,36,54,18,76,73,49,65\r\n93,73,17,49,42,35,98,84,23,96,47,54,36,46,59,34,38,44,74\r\n51,64,72,37,12,42,35,49,89,82,73,26,93,56,13,29,79,78,92,24,83\r\n24,73,17,49,87,63,96,47,36,59,34,38,44\r\n44,59,71,78,37,92,12,31,88\r\n93,11,51,82,26,53,24,42,76\r\n72,56,51,83,89,82,79,76,24,73,42,87,98,63,84,65,23\r\n15,88,41,13,29,53,92,56,51,89,76\r\n15,46,38,36,17,23,63,84,35,73,59,74,98,65,34,96,25\r\n23,54,36,46,59,34,44,74,15,31,88,71,41,11,13,29,37\r\n68,71,41,11,13,64,29,53,78,37,92,12,72,56,26,51,83,89,82,79,24\r\n31,92,74,46,38,13,47,59,29,41,68,11,15,12,78,71,54,53,44\r\n93,73,17,49,87,98,18,84,65,23,96,47,54,36,59,34,38,44,74\r\n87,98,84,65,96,47,46,59,34,74,15,31,88,71,41\r\n87,42,18,98,72\r\n72,56,51,83,89,76,24,93,17,49,35,98,63,18,84\r\n13,89,11,64,73,76,29,26,53,72,56,17,83,42,37,49,78,82,79\r\n44,15,68,31,88,71,41,13,29,53,92,12,56,26,51,83,89\r\n93,44,35,98,87,63,46,84,47,25,59,42,54,17,73,34,24,49,96,65,18,23,38\r\n53,78,37,92,12,72,56,26,51,83,89,82,79,76,24,73,17,49,42,35,87,25,98\r\n89,79,76,49,35\r\n15,88,13,29,56,79,76\r\n83,56,42,12,92,73,49,72,93,18,98,87,37,17,79,82,63\r\n15,68,88,71,41,11,13,53,78,37,92,12,72,56,26,51,83,89,82,79,76\r\n49,23,96,42,79,98,65,59,84,87,34\r\n25,98,65,36,15,41,11\r\n47,11,59,38,23,41,44,54,34,64,71,15,63,84,46,36,88,74,31,96,18\r\n74,15,68,31,71,11,13,64,29,78,37,92,12,72,56,26,51,83,89,82,79\r\n38,15,71,11,78,56,51,83,89\r\n74,34,15,88,31,12,47,44,38,78,68,41,36,64,46,92,53,13,71,54,59,29,37\r\n41,11,13,64,29,53,92,12,56,26,83,89,82,79,76,93,73,17,49\r\n24,73,49,35,87,63,54,46,59,38,44\r\n46,41,36,88,44,47,74,63,54,65,15,84,59,23,96,98,13,11,31\r\n78,38,68,26,92,56,12,41,34,11,13,53,46\r\n98,47,38,65,49,42,35,31,34,36,23,63,68\r\n35,87,98,63,18,84,65,23,96,47,54,46,34,44,74,68,31,88,71\r\n79,93,17,49,35,25,98,63,18,84,65,59,34\r\n87,68,65,17,46,74,63,59,47\r\n11,23,59,88,84,34,31,44,36,18,64,15,71,41,65,13,68,54,38\r\n56,71,34,59,44,11,78,38,36\r\n88,31,89,53,56,13,71\r\n74,68,71,41,11,13,64,12,72,82,79\r\n47,36,59,38,68,88,37\r\n84,76,24,96,18,87,73,65,36,23,54,17,93,49,83,82,79,35,42,63,47\r\n53,54,71,29,47,46,34,23,31,96,13,78,68,59,36,88,11,37,38,15,74\r\n18,49,36,84,17,59,96,79,87,93,47,34,42,73,54\r\n31,59,56,13,11\r\n24,93,17,49,42,35,87,25,63,18,84,65,96,47,54,36,46,59,34,38,44\r\n89,92,79,64,37,31,41,26,93\r\n64,37,92,51,89,76,24,73,87\r\n23,65,46,84,47,88,98,59,11,36,18,68,74,38,31,25,96\r\n18,64,41,23,15,74,84,59,46,13,47,71,36,88,44,38,63,31,68,54,34,11,65\r\n89,82,76,73,35,25,65,54,46\r\n24,73,17,25,98,18,96,47,36,59,34,38,44\r\n36,59,68,71,41,13,53\r\n92,12,72,56,26,51,89,82,79,76,24,93,73,17,49,42,35,87,25,98,63,18,84\r\n74,15,88,71,41,11,64,29,53,78,37,92,72,26,51,83,89,82,79\r\n51,83,89,76,24,87,18,65,23\r\n74,68,64,29,78,37,92,12,83,89,79\r\n74,15,44,64,31,41,38,26,92,71,88,29,78,59,68,34,11,46,56\r\n47,24,36,65,98,59,96,84,46,25,34,54,35,73,23,38,93,18,17,87,42,76,63\r\n17,98,63,18,44,15,68\r\n26,51,83,89,82,76,24,93,73,17,49,42,35,87,25,98,63,18,84,65,23,96,47\r\n18,74,65,42,84,88,31,35,63\r\n36,46,59,34,38,44,74,15,68,31,88,71,41,11,13,29,53,78,37,92,12,72,56\r\n82,79,76,24,93,17,42,35,25,98,18,84,65,23,96,47,54,36,59\r\n34,38,44,74,88,13,64,29,53,37,72,56,26,51,83\r\n29,53,78,37,92,12,72,56,26,51,83,89,82,79,76,24,93,73,17,49,42,35,25\r\n53,79,56,72,78,26,29,15,88,92,76,11,64\r\n63,12,49,84,56,17,18,87,65\r\n74,15,31,88,41,11,13,64,29,53,78,92,12,72,56,26,51,83,89,82,79\r\n96,47,38,44,31,11,64,29,78\r\n23,54,11,47,63,64,15\r\n82,24,93,73,17,49,42,98,23,96,36,46,59\r\n51,83,89,82,76,93,73,17,49,42,35,87,25,18,84,23,96,47,54\r\n11,13,64,29,37,92,12,72,56,26,83,89,79,24,93,73,17,49,42\r\n83,76,42,63,84\r\n84,23,47,68,31,71,64,29,53\r\n34,35,63,36,96,38,25,54,74,49,59\r\n44,29,59,41,54,34,36,71,37,13,53,88,96,11,31,47,74,64,92\r\n76,93,73,17,49,42,35,87,25,98,63,18,84,65,23,96,47,54,36,46,34\r\n82,79,76,73,42,35,87,25,63,18,84,96,47,36,59\r\n56,84,25,42,87,23,73,76,96\r\n78,12,83,89,93,73,49,35,87\r\n74,72,12,53,11,34,29,64,59,46,15\r\n12,72,79,26,56\r\n29,53,78,37,12,56,26,51,83,89,82,79,76,24,93,73,17,42,35,87,25\r\n12,76,31,24,37,26,92,68,82,56,83,71,89,29,11,78,41,79,51\r\n54,74,73,36,63,93,17\r\n46,92,15,11,13,56,78,44,36,53,34,68,37,12,59\r\n18,35,93,65,73,54,76,17,59,46,82\r\n36,15,74,84,68,71,34,44,65,63,41,96,38,87,88,47,18,46,23,31,54\r\n64,15,44,78,51,13,71,74,41,83,38,26,34,12,92,31,68,11,88,56,29\r\n63,18,84,23,96,47,54,36,46,59,34,38,44,74,15,68,31,88,71,41,11,13,64\r\n98,76,65,17,51,83,24,42,84,73,35,72,82\r\n54,46,59,34,74,11,64,12,72\r\n93,34,63,35,73,98,65,18,46,54,17,44,42,59,74\r\n26,37,49,42,51,18,73,93,79\r\n65,23,96,54,46,59,34,38,44,15,68,31,88,71,41,11,13,64,29,53,78\r\n83,89,82,76,73,35,87,25,18,84,96,47,36\r\n26,41,93,12,79,64,31\r\n84,23,47,54,34,38,44,74,15,68,88,29,53\r\n88,41,11,13,64,29,53,37,92,12,72,51,79,93,73\r\n44,74,15,68,31,88,71,41,11,64,29,53,78,37,92,12,72,56,26,51,83,89,82\r\n29,74,92,34,41,26,11,64,12\r\n17,49,42,87,25,98,63,18,84,65,23,96,47,54,36,46,59,34,38,44,74,15,68\r\n79,18,82,49,76,36,24,96,87,73,59,35,63,65,17,98,54,23,42\r\n41,73,83,53,17,93,71,89,56,92,26\r\n87,25,98,63,65,23,54,36,59,34,44,74,15,68,88,71,41\r\n24,26,92,12,93,17,49,42,83,56,78,89,63\r\n49,25,56,76,79,63,12,51,65,84,18,35,87\r\n23,46,47,42,87,17,25,38,63,84,74,34,59,44,54,98,96,35,65,18,93,73,49\r\n84,65,34,38,25\r\n25,35,98,42,88,23,84,31,18,54,36,96,87\r\n17,24,47,87,79,83,63,25,26\r\n82,79,76,42,18,47,36\r\n37,17,83,26,18,79,25,24,35\r\n41,37,92,56,89,79,49\r\n34,18,79,63,98,23,47\r\n34,44,74,68,31,41,13,53,12,56,83\r\n23,47,54,46,59,44,74,15,68,31,88,71,41,11,29,53,37\r\n54,79,65,18,24,47,34,63,25\r\n84,54,59,34,15,71,41,13,53\r\n63,84,65,23,96,47,36,46,59,34,38,44,74,15,68,31,88,71,11,13,64\r\n37,12,26,51,89,79,73\r\n35,18,31,47,42,49,36,63,74,59,38,15,87,46,25,44,68,98,54\r\n96,47,36,59,34,44,74,15,68,31,13,64,53,78,92\r\n17,49,42,35,25,98,18,84,65,23,96,47,54,36,46,59,34,38,44,74,15\r\n42,83,87,56,65,18,35,17,89,63,12,26,84,25,49,51,24\r\n15,68,31,88,71,41,11,13,64,29,53,78,37,92,12,72,56,26,51,83,89,82,79\r\n17,42,35,87,98,84,23,96,47,54,36,59,34,74,68\r\n26,51,83,89,82,79,76,24,93,73,17,49,42,35,87,25,63,18,84,65,23,96,47\r\n54,46,59,34,44,74,15,68,31,71,41,11,13,64,37,92,72\r\n31,37,72,56,26,83,82\r\n34,38,44,74,15,68,31,88,71,11,13,64,29,53,78,37,92,12,72,56,26,51,83\r\n63,25,84,98,34,49,54,73,47,74,96,46,65,42,35,15,59,44,23\r\n88,71,64,29,37,92,72,89,73\r\n65,31,15,84,46,34,23,38,71,53,54,68,41\r\n44,31,88,71,41,13,64,78,37,92,12,72,89\r\n35,83,56,73,72,84,49,25,87,24,23,42,82,18,93\r\n12,72,56,26,51,83,89,82,79,24,93,73,17,49,87,25,98,63,84\r\n31,88,71,41,11,13,64,29,53,78,37,92,12,72,56,26,51,83,89,79,76,24,93\r\n98,65,23,96,47,54,36,46,59,34,38,74,31,41,13\r\n89,98,18,84,96,54,46\r\n53,78,72,56,51,76,49,25,98\r\n98,37,12,92,17,56,93,42,51,63,25,79,87,49,73,89,26,72,83,35,82\r\n23,96,74,71,13\r\n88,53,72,29,38,68,78,83,26,74,56,41,64,89,37,11,13,71,44,31,12\r\n13,53,92,12,51,83,79,76,24,17,35\r\n17,42,35,25,84,65,23,96,54,46,44\r\n63,44,84,34,23,36,88,74,38,59,15,18,35,71,25,47,98,46,65\r\n38,53,44,37,59,12,15,13,54,72,46\r\n13,93,41,12,26,89,31,29,82,71,92\r\n25,36,65,63,98,84,35,49,93,54,47,17,24\r\n78,37,92,12,26,51,79,24,49,42,35,87,25,98,63\r\n65,23,96,47,54,46,59,34,44,74,15,31,88,41,64,29,78\r\n44,42,31,63,98,68,49,84,34,18,15\r\n31,41,11,64,29,92,93\r\n34,12,88,37,74,41,15,71,38,13,92,31,83,11,51,56,64,68,53\r\n89,49,83,76,78,64,26,93,41,53,73,24,79,51,17,37,92,11,72,29,82,13,56\r\n44,37,38,59,74,92,31,54,47,46,64,41,78,36,15,96,68,88,11\r\n88,25,54,18,34,41,11,71,59,65,47,38,68\r\n18,65,23,96,47,54,36,59,44,15,31,71,41,11,13,64,29\r\n13,78,49,24,92,53,72,11,26,51,17,37,56,73,12,42,89\r\n83,89,79,76,24,93,73,17,49,35,25,98,63,84,65,47,36\r\n88,41,13,64,53,78,37,12,26,83,79,76,24,93,73\r\n84,87,82,42,63,49,96,73,56\r\n71,13,29,44,53,59,54,74,47,64,37,38,68,96,15,23,34\r\n87,44,18,54,31,71,74,84,47,65,15,23,98,35,59\r\n79,51,68,12,53,29,72,26,83,71,88,11,31,13,74,82,15,37,64,92,56\r\n89,87,64,26,79,56,83\r\n"; 
        public const string test_input_2 = test_input_1;
        public const string input_2 = input_1;

        public static long Part_1(string input)
        {
            string[] linesStr = input.Split("\r\n", StringSplitOptions.TrimEntries);
            List<string> rulesStr = new List<string>();
            List<string> printsStr = new List<string>();
            bool readRules = true;
            for (int i = 0; i < linesStr.Length; i++) 
            {
                if (linesStr[i] == "") { readRules = false; continue; }
                if (readRules) { rulesStr.Add(linesStr[i]); }
                else { printsStr.Add(linesStr[i]); }
            }

            (long, long)[] rules = new (long, long)[rulesStr.Count];
            for (int i = 0; i < rulesStr.Count; i++)
            {
                string[] ruleStr = rulesStr[i].Split("|", StringSplitOptions.TrimEntries | StringSplitOptions.RemoveEmptyEntries);
                rules[i].Item1 = long.Parse(ruleStr[0]);
                rules[i].Item2 = long.Parse(ruleStr[1]);
            }

            List<long>[] prints = new List<long>[printsStr.Count];
            for (int i = 0; i < printsStr.Count; i++)
            {
                string[] printStr = printsStr[i].Split(",", StringSplitOptions.TrimEntries | StringSplitOptions.RemoveEmptyEntries);
                prints[i] = new List<long>();
                for (int j = 0; j < printStr.Length; j++)
                {
                    prints[i].Add(long.Parse(printStr[j]));
                }
            }

            long sum = 0;
            for (int i = 0; i < prints.Length; i++)
            {
                long[] printsArr = prints[i].ToArray();
                if (CheckLegal(rules, printsArr))
                {
                    sum += printsArr[printsArr.Length / 2];
                }
            }
            return sum;
        }

        public static long Part_2(string input)
        {
            string[] linesStr = input.Split("\r\n", StringSplitOptions.TrimEntries);
            List<string> rulesStr = new List<string>();
            List<string> printsStr = new List<string>();
            bool readRules = true;
            for (int i = 0; i < linesStr.Length; i++)
            {
                if (linesStr[i] == "") { readRules = false; continue; }
                if (readRules) { rulesStr.Add(linesStr[i]); }
                else { printsStr.Add(linesStr[i]); }
            }

            (long, long)[] rules = new (long, long)[rulesStr.Count];
            for (int i = 0; i < rulesStr.Count; i++)
            {
                string[] ruleStr = rulesStr[i].Split("|", StringSplitOptions.TrimEntries | StringSplitOptions.RemoveEmptyEntries);
                rules[i].Item1 = long.Parse(ruleStr[0]);
                rules[i].Item2 = long.Parse(ruleStr[1]);
            }

            List<long>[] prints = new List<long>[printsStr.Count];
            for (int i = 0; i < printsStr.Count; i++)
            {
                string[] printStr = printsStr[i].Split(",", StringSplitOptions.TrimEntries | StringSplitOptions.RemoveEmptyEntries);
                prints[i] = new List<long>();
                for (int j = 0; j < printStr.Length; j++)
                {
                    prints[i].Add(long.Parse(printStr[j]));
                }
            }

            long sum = 0;
            for (int i = 0; i < prints.Length; i++)
            {
                long[] printsArr = prints[i].ToArray();
                if (CheckLegal(rules, printsArr) == false)
                {
                    long[] fixedPrint = FixPrint(rules, printsArr);
                    sum += fixedPrint[fixedPrint.Length / 2];
                }
            }
            return sum;
        }

        private static bool CheckLegal((long, long)[] rules, long[] print)
        {
            bool legal = true;
            for (int i = 0; i < print.Length; i++)
            {
                long[] before = new long[i];
                long[] after = new long[print.Length - i - 1];
                Array.Copy(print, before, i);
                Array.Copy(print, i + 1, after, 0, after.Length);
                for (int j = 0; j < rules.Length; j++)
                {
                    if (print[i] != rules[j].Item1 && print[i] != rules[j].Item2) { continue; }
                    if (print[i] == rules[j].Item1 && (before.Contains(rules[j].Item2) == false)) { continue; }
                    if (print[i] == rules[j].Item2 && (after.Contains(rules[j].Item2) == false)) { continue; }
                    legal = false;
                    break;
                }
                if (legal == false) { break; }
            }
            return legal;
        }

        private static long[] FixPrint((long, long)[] rules, long[] errPrint)
        {
            Dictionary<long, List<long>> before = new Dictionary<long, List<long>>();
            Dictionary<long, List<long>> after = new Dictionary<long, List<long>>();
            long[] fixedPrint = new long[errPrint.Length]; // TODO replace

            for (int i = 0; i < errPrint.Length; i++)
            {
                before.Add(errPrint[i], new List<long>());
                after.Add(errPrint[i], new List<long>());
                for (int j = 0; j < rules.Length; j++)
                {
                    if (rules[j].Item1 == errPrint[i] && errPrint.Contains(rules[j].Item2))
                    {
                        after[errPrint[i]].Add(rules[j].Item2);
                    }
                    else if (rules[j].Item2 == errPrint[i] && errPrint.Contains(rules[j].Item1))
                    {
                        before[errPrint[i]].Add(rules[j].Item1);
                    }
                }
            }
            for (int i = 0; i < errPrint.Length; i++)
            {
                (long, long) lowest = (0, long.MaxValue);
                foreach (KeyValuePair<long, List<long>> kvp in before)
                {
                    if (kvp.Value.Count < lowest.Item2) { lowest.Item1 = kvp.Key; lowest.Item2 = kvp.Value.Count; }
                }
                fixedPrint[i] = lowest.Item1;
                before.Remove(lowest.Item1);
            }
            //Array.Sort
            return fixedPrint;
        }


    }
}
